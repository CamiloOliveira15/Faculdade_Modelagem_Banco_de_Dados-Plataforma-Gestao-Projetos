-- CRIAÇÃO DAS TABELAS

CREATE TABLE IF NOT EXISTS CLIENTS (
    ClientID INT AUTO_INCREMENT PRIMARY KEY,
    ClientName VARCHAR(100) NOT NULL,
    Email VARCHAR(100) UNIQUE,
    Phone VARCHAR(20)
);

CREATE TABLE IF NOT EXISTS EMPLOYEES (
    EmployeeID INT AUTO_INCREMENT PRIMARY KEY,
    FullName VARCHAR(100) NOT NULL,
    Email VARCHAR(100) UNIQUE,
    Role VARCHAR(50)
);

CREATE TABLE IF NOT EXISTS PROJECTS (
    ProjectID INT AUTO_INCREMENT PRIMARY KEY,
    ProjectName VARCHAR(100) NOT NULL,
    StartDate DATE,
    EndDate DATE,
    ClientID INT,
    ManagerID INT,
    FOREIGN KEY (ClientID) REFERENCES CLIENTS(ClientID),
    FOREIGN KEY (ManagerID) REFERENCES EMPLOYEES(EmployeeID)
);

-- INSERÇÃO DE DADOS (INSERT)


-- Inserindo Clientes
INSERT INTO CLIENTS (ClientName, Email, Phone) VALUES 
('TechSolutions Ltda', 'contato@techsolutions.com', '(11) 98765-4321'),
('InovaSoft Inc', 'comercial@inovasoft.com', '(21) 91234-5678'),
('Banco Digital Future', 'ti@futurebank.com', '(11) 3333-4444'),
('Varejo Express', 'sac@varejoexpress.com.br', '(31) 99876-5432'),
('EducaTech EAD', 'suporte@educatech.com', '(41) 3030-2020');

-- Inserindo Funcionários
INSERT INTO EMPLOYEES (FullName, Email, Role) VALUES 
('Ana Silva', 'ana.silva@taskflow.com', 'Gerente de Projetos'),
('Carlos Souza', 'carlos.souza@taskflow.com', 'Tech Lead'),
('Beatriz Oliveira', 'beatriz.oliveira@taskflow.com', 'Scrum Master'),
('João Mendes', 'joao.mendes@taskflow.com', 'Desenvolvedor Senior'),
('Fernanda Lima', 'fernanda.lima@taskflow.com', 'Gerente de Contas');

-- Inserindo Projetos
INSERT INTO PROJECTS (ProjectName, StartDate, EndDate, ClientID, ManagerID) VALUES 
('App Mobile Banking', '2023-01-15', '2023-12-20', 3, 1),
('E-commerce Varejo', '2023-03-10', '2023-09-30', 4, 2),
('Plataforma LMS', '2023-05-01', '2024-02-28', 5, 1),
('Migração Cloud', '2023-06-01', '2023-08-15', 1, 3),
('API de Pagamentos', '2023-02-01', '2023-07-01', 2, 2);


-- CONSULTAS (SELECT)

-- Listar todos os funcionários da empresa
SELECT * FROM EMPLOYEES;

-- Listar Projetos e os nomes de seus Clientes
SELECT 
    p.ProjectName AS 'Nome do Projeto',
    c.ClientName AS 'Nome do Cliente',
    p.StartDate AS 'Início',
    p.EndDate AS 'Fim'
FROM PROJECTS p
JOIN CLIENTS c ON p.ClientID = c.ClientID;

-- Listar projetos gerenciados por 'Ana Silva'
SELECT 
    p.ProjectName,
    e.FullName AS 'Gerente Responsável'
FROM PROJECTS p
JOIN EMPLOYEES e ON p.ManagerID = e.EmployeeID
WHERE e.FullName = 'Ana Silva';

-- Ordenar projetos por data de término
SELECT ProjectName, EndDate 
FROM PROJECTS 
ORDER BY EndDate DESC;


-- ATUALIZAÇÃO DE DADOS (UPDATE)

-- Atualizar o telefone de um cliente específico
UPDATE CLIENTS 
SET Phone = '(11) 99999-9999' 
WHERE ClientName = 'TechSolutions Ltda';

-- Estender o prazo de um projeto
UPDATE PROJECTS 
SET EndDate = '2024-06-30' 
WHERE ProjectName = 'Plataforma LMS';

-- Promover um funcionário
UPDATE EMPLOYEES 
SET Role = 'Diretor de Tecnologia' 
WHERE FullName = 'Carlos Souza';


-- EXCLUSÃO DE DADOS (DELETE)

-- Excluir um projeto cancelado
DELETE FROM PROJECTS 
WHERE ProjectName = 'Migração Cloud';

-- Excluir um funcionário
DELETE FROM EMPLOYEES 
WHERE FullName = 'João Mendes';

-- Excluir clientes que não possuem telefone cadastrado
DELETE FROM CLIENTS 
WHERE Phone IS NULL;
